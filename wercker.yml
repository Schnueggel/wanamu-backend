build:
    box: node:0.12.7
    steps:
        - script:
            name: Build
            code: |
                npm install -g gulp
                npm i
                gulp build
                npm test
                cp -a . $WERCKER_OUTPUT_DIR
deploy:
    box: golio/ubuntu:latest
    steps:
        - add-ssh-key:
            keyname: DEPLOY_KEY
        - script:
            name: install ssh
            code: |
              ssh-agent -s
        - script:
            name: Deploy
            code: |
              git config --global user.email "wercker@wanamu.com"
              git config --global user.name "Wercker"
              echo -e "Host $DEPLOY_HOST\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
              git add .
              git branch
              git commit --allow-empty -m "Wercker Push"
              git remote add deploy $DEPLOY_REPO_URL
              git push -f deploy $WERCKER_GIT_BRANCH:master
              git checkout master
              git reset --hard $WERCKER_GIT_BRANCH
              git remote add deploy $DEPLOY_REPO_URL
              git push -f deploy master
    after-steps:
        - slack-notifier:
            url: $SLACK_WEBHOOK_URL
            channel: wercker-notify
            username: werckerbot
